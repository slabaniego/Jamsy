<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Select Artists</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #1e003e 0%, #0f001f 100%);
            --text-main: #ffffff;
            --text-muted: #bbb;
            --card-bg: rgba(255, 255, 255, 0.07);
            --card-border: rgba(255,255,255,0.2);
            --button-bg: linear-gradient(135deg, #2196F3, #0b7dda);
            --button-hover: linear-gradient(135deg, #0b7dda, #2196F3);
            --selected-border: #4CAF50;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-main);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 15px;
            font-size: 26px;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(0,0,0,0.2);
        }

        .workout-header, .mood-header {
            text-align: center;
        }

        .instruction {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 12px;
            margin: 15px auto;
            text-align: center;
            max-width: 600px;
            font-size: 16px;
            line-height: 1.4;
        }

        .selected-count {
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            margin: 10px 0;
        }

        .max-selection {
            color: #ff4444;
            font-size: 14px;
            display: none;
        }

        .error {
            color: #f44336;
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
        }

        .artist-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .artist-item {
            text-align: center;
            cursor: pointer;
            background: var(--card-bg);
            border-radius: 20px;
            padding: 10px;
            border: 2px solid var(--card-border);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .artist-item:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(255,255,255,0.1);
        }

        .artist-item.selected {
            border-color: var(--selected-border);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.5);
        }

        .artist-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--card-border);
            transition: all 0.3s ease;
        }

        .artist-item.selected .artist-image {
            border-color: var(--selected-border);
            transform: scale(1.05);
        }

        .artist-name {
            margin-top: 8px;
            font-size: 14px;
            color: var(--text-main);
            font-weight: 500;
        }

        .submit-btn {
            background: var(--button-bg);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .submit-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        .submit-btn:hover:enabled {
            background: var(--button-hover);
            transform: translateY(-2px);
        }

        @media (max-width: 480px) {
            .artist-image {
                width: 80px;
                height: 80px;
            }
            .artist-name {
                font-size: 12px;
            }
            .submit-btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>

<div th:if="${error}" class="error">
    <span th:text="${error}"></span>
</div>

<h1>Build Your Perfect <span th:text="${workout}"></span> Playlist</h1>

<div class="instruction">
    <strong>Which artists define your </strong>
    <span th:text="${#strings.toLowerCase(workout)}"></span>
    <strong> session the best?</strong>
    <br>Select exactly 5 artists that match your <span th:text="${mood}"></span> vibe!
</div>

<div class="selected-count">
    Selected: <span id="selectedCount">0</span> / 5 artists
    <div id="maxSelection" class="max-selection">Maximum 5 artists selected!</div>
</div>

<form action="/artists/select" method="post" id="discoveryForm">
    <input type="hidden" name="workout" th:value="${workout}" />
    <input type="hidden" name="mood" th:value="${mood}" />
    <input type="hidden" name="artistNames" id="artistNamesInput" />
    <input type="hidden" name="action" id="actionInput" />

    <div class="artist-grid">
        <div th:each="artist : ${artists}" class="artist-item" th:id="'artist-item-' + ${artist.id}">
            <input type="checkbox" class="artist-checkbox" 
                   name="selectedArtists" th:value="${artist.id}" 
                   th:data-name="${artist.name}"
                   th:id="'artist-' + ${artist.id}" />
            <label th:attr="for='artist-' + ${artist.id}" style="cursor: pointer;">
                <img th:src="${artist.imageUrl}" 
                     class="artist-image"
                     th:alt="${artist.name}" />
                <div class="artist-name" th:text="${artist.name}"></div>
            </label>
        </div>
    </div>

    <div style="text-align: center;">
        <button type="button" onclick="submitForm('discover')" class="submit-btn" id="discoverBtn" disabled>
            Start Discovering New Artists
        </button>
        <button type="button" onclick="submitForm('familiar')" class="submit-btn" id="familiarBtn" disabled>
            Create a Familiar Playlist Today
        </button>
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('.artist-checkbox');
    const discoverBtn = document.getElementById('discoverBtn');
    const familiarBtn = document.getElementById('familiarBtn');
    const selectedCountElement = document.getElementById('selectedCount');
    const maxSelection = 5;
    
    function updateSelection() {
        const selectedCount = document.querySelectorAll('.artist-checkbox:checked').length;
        selectedCountElement.textContent = selectedCount;
        
        const buttonsEnabled = selectedCount === maxSelection;
        discoverBtn.disabled = !buttonsEnabled;
        familiarBtn.disabled = !buttonsEnabled;
        
        checkboxes.forEach(checkbox => {
            const artistItem = checkbox.closest('.artist-item');
            if (checkbox.checked) {
                artistItem.classList.add('selected');
            } else {
                artistItem.classList.remove('selected');
            }
        });
    }
    
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const selectedCount = document.querySelectorAll('.artist-checkbox:checked').length;
            if (selectedCount > maxSelection) {
                this.checked = false;
                alert('Maximum 5 artists selected!');
            }
            updateSelection();
        });
    });
    
    updateSelection();
});

function submitForm(action) {
    const form = document.getElementById('discoveryForm');
    const artistNamesInput = document.getElementById('artistNamesInput');
    const actionInput = document.getElementById('actionInput');
    
    const selectedNames = [];
    const selectedIds = [];
    
    document.querySelectorAll('.artist-checkbox:checked').forEach(checkbox => {
        selectedNames.push(checkbox.dataset.name);
        selectedIds.push(checkbox.value);
    });
    
    artistNamesInput.value = JSON.stringify(selectedNames);
    actionInput.value = action;
    
    form.submit();
}
</script>

</body>
</html>
